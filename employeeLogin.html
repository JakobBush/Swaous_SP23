<!DOCTYPE html>
<html lang="en-US">
<title>Employee Login</title>
<link rel="icon" type="image/jpg" href="fav.jfif">
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
<div class="myDiv">
<body>
<div class="logo">
<img src="RisenOneLogo.png" alt="Risen One Logo" width="100" height="100">
</div>
<form action="reportPage.html" method="post">


<h1><u>RisenOne Employee Log-in</u></h1>


  <div class="log">
    <label for="uname"><b>Username: </b></label>
    <input type="text" placeholder="Enter Username" name="uname" required> <br><br>

    <label for="psw"><b>Password: </b></label>
    <input type="password" placeholder="Enter Password" name="psw" required> <br><br>




<p><b>Please Scan the QR Code for a code and enter it to continue.</b></p>
<img src="data:image/png;base64,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">
<br><br>


<label for="ga"><b>Google Authenticator Code: </b></label>
    <input type="text" placeholder="XXXXXX" id="ga" required> <br><br>

<!--


	Make it read the stored code in node.js
	If it is the same allow log on, if fail tell them to try again.
	After this form is completed, Send to the reports page and at the top say welcome {{name}}


	if

-->
    <button id="buttonlogon" class="open-button" onclick="logon()">Login</button> 
    
    <button class="export-button">Cancel</button><br><br>
	
</form>

  </div>
	<p id="output"></p>
<script>
export class LoginComponent {
    form:FormGroup;

    constructor(private fb:FormBuilder, 
                 private authService: AuthService, 
                 private router: Router) {  //Don't know if needed or useable

        this.form = this.fb.group({
            uname: ['',Validators.required],
            psw: ['',Validators.required]
        });
    }

    login() {
        const val = this.form.value;

        if (val.uname && val.psw) {
            this.authService.login(val.uname, val.psw)
                .subscribe(
                    () => {
                        console.log("User is logged in");
                        this.router.navigateByUrl('/');
                    }
                );
        }
    }
}

@Injectable()
export class AuthService {
     
    constructor(private http: HttpClient) {
    }
      
    login(uname:string, psw:string ) {
        return this.http.post<User>('/api/login', {email, password})
            // this is just the HTTP call, 
            // we still need to handle the reception of the token
            .shareReplay();
    }
}


//NodeSection//

import {Request, Response} from "express";
import * as express from 'express';
const bodyParser = require('body-parser');
const cookieParser = require('cookie-parser');
import * as jwt from 'jsonwebtoken';
import * as fs from "fs";

const app: Application = express();

app.use(bodyParser.json());

app.route('/api/login')
    .post(loginRoute);

const RSA_PRIVATE_KEY = fs.readFileSync('./private.key');

export function loginRoute(req: Request, res: Response) {

    const username = req.body.uname,
    const password = req.body.psw;

	awspsw = this.http.get('/aws/passwordgrad/{username}')

	if(password == awspassword){

        const jwtBearerToken = jwt.sign({}, RSA_PRIVATE_KEY, {
                algorithm: 'RS256',
                expiresIn: 120,
                subject: username
            }

          // send the JWT back to the user
          // TODO - multiple options available    
	}                        
    }
    else {
        // send status 401 Unauthorized
        res.sendStatus(401); 
    }
}
</script>


<style>


h1 {
text-align: center;
}

.myDiv {
border-style: solid;
text-align: center;
  margin-right: 250px;
  margin-left: 250px;
  margin-top: 100px;
  background-color: white;
}


body {
 background-image: url('RisenOneGradient.png');
  background-repeat: no-repeat;
  background-attachment: fixed;
  background-size: 100% 100%;
  }



.open-button {
 padding: 16px 20px;
  cursor: pointer;
  color: white;
  background-color: #ffcc34;
  border-color: black;
  font-weight: bold;

}


.export-button {

  padding: 16px 20px;
   cursor: pointer;
   color: white;
   background-color: orange;
  border-color: black;
  font-weight: bold;
}



</style>
</body>
</html>

